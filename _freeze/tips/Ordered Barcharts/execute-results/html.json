{
  "hash": "caf931b395222e7749ad9552b8a5bedd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Creating Ordered Bar Plots in R\"\nformat: html\nexecute:\n  warning: false\n  message: false\n---\n\n\n\n\n## Introduction\n\nOrdered bar plots are essential for effective data visualization. This guide demonstrates various methods to create ordered bar plots in R using `forcats::fct_reorder` and related functions. We'll use different datasets and scenarios to illustrate each approach.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n```\n:::\n\n\n\n\n## Basic Reordering with fct_reorder\n\nThe most common use case is reordering a factor based on another numeric variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  group_by(species) %>%\n  summarise(mean_mass = mean(body_mass_g, na.rm = TRUE)) %>%\n  ggplot(aes(x = fct_reorder(species, mean_mass), y = mean_mass)) +\n  geom_col() +\n  labs(x = \"Species\", y = \"Mean Body Mass (g)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/basic-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Reordering with Summarized Data\n\nWhen working with grouped data, you might need to reorder based on a summary statistic:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstarwars %>%\n  group_by(species) %>%\n  filter(n() >= 3) %>%\n  summarise(avg_height = mean(height, na.rm = TRUE)) %>%\n  ggplot(aes(x = fct_reorder(species, avg_height), y = avg_height)) +\n  geom_col() +\n  coord_flip() +\n  labs(x = \"Species\", y = \"Average Height\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/summarized-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Reordering Based on Multiple Variables\n\n`fct_reorder2()` is particularly useful for ordering grouped bar charts when you want to consider the relationship between two variables. Here's an example using the diamonds dataset:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds %>%\n  group_by(cut, clarity) %>%\n  summarise(\n    mean_price = mean(price),\n    .groups = \"drop\"\n  ) %>%\n  ggplot(aes(x = fct_reorder2(cut, clarity, mean_price), \n             y = mean_price, \n             fill = clarity)) +\n  geom_col(position = \"dodge\") +\n  labs(x = \"Cut\",\n       y = \"Mean Price ($)\",\n       fill = \"Clarity\",\n       title = \"Diamond Prices by Cut and Clarity\",\n       subtitle = \"Cuts ordered by their price relationship with clarity\") +\n  theme_minimal() +\n  scale_fill_viridis_d()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/multiple-variable-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\nThis example demonstrates why `fct_reorder2()` is powerful for grouped bar charts:\n\n1.  It orders the cuts based on how their prices vary across clarity levels\n2.  The ordering considers the interaction between cut and clarity\n3.  Makes it easier to see patterns in how price varies across both dimensions\n\nThe key difference from `fct_reorder()` is that `fct_reorder2()` considers two variables (here, clarity and mean_price) when ordering the factor (cut). This is especially useful when you want to order categories based on their relationship with a grouping variable.\n\n## Reverse Ordering with fct_rev\n\nSometimes you want to reverse the order of your bars:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpg %>%\n  group_by(manufacturer) %>%\n  summarise(avg_hwy = mean(hwy)) %>%\n  ggplot(aes(x = fct_rev(fct_reorder(manufacturer, avg_hwy)), y = avg_hwy)) +\n  geom_col() +\n  coord_flip() +\n  labs(x = \"Manufacturer\", y = \"Average Highway MPG\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/reverse-ordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Manual Reordering with fct_relevel\n\nWhen you need specific control over the order:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  mutate(species = fct_relevel(species, \"Gentoo\", \"Adelie\", \"Chinstrap\")) %>%\n  ggplot(aes(x = species, y = body_mass_g)) +\n  geom_boxplot() +\n  labs(x = \"Species\", y = \"Body Mass (g)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/manual-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Reordering Within Groups\n\nFor faceted plots, you might want to order within each facet:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(aes(x = fct_reorder(species, body_mass_g, .desc = TRUE), \n             y = body_mass_g)) +\n  geom_boxplot() +\n  facet_wrap(~sex) +\n  labs(x = \"Species\", y = \"Body Mass (g)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/within-group-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Using other tidyverse functions\n\nSometimes it's clearer to reorder during data transformation:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmtcars %>%\n  rownames_to_column(\"car\") %>%\n  arrange(desc(mpg)) %>%\n  mutate(car = factor(car, levels = car)) %>%\n  ggplot(aes(x = car, y = mpg)) +\n  geom_col() +\n  coord_flip() +\n  labs(x = \"Car Model\", y = \"Miles Per Gallon\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/tidyverse-reordering-1.png){width=672}\n:::\n:::\n\n\n\n\n## Ordering by Frequency with fct_infreq\n\n`fct_infreq()` is a simple but powerful function for ordering factors by their frequency of occurrence. Here's how to use it:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic frequency ordering\nmpg %>%\n  mutate(class = fct_infreq(class)) %>%\n  ggplot(aes(x = class)) +\n  geom_bar(fill = \"steelblue\") +\n  labs(\n    x = \"Vehicle Class\",\n    y = \"Count\",\n    title = \"Vehicle Classes by Frequency\",\n    subtitle = \"Ordered from most to least common\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/frequency-ordering-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Combining with fct_rev for reverse order\nmpg %>%\n  mutate(class = fct_rev(fct_infreq(class))) %>%\n  ggplot(aes(x = class)) +\n  geom_bar(fill = \"darkred\") +\n  labs(\n    x = \"Vehicle Class\",\n    y = \"Count\",\n    title = \"Vehicle Classes by Frequency\",\n    subtitle = \"Ordered from least to most common\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/frequency-ordering-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Using with grouped data\nmpg %>%\n  mutate(class = fct_infreq(class)) %>%\n  ggplot(aes(x = class, fill = drv)) +\n  geom_bar(position = \"dodge\") +\n  labs(\n    x = \"Vehicle Class\",\n    y = \"Count\",\n    fill = \"Drive Type\",\n    title = \"Vehicle Classes by Drive Type\",\n    subtitle = \"Classes ordered by overall frequency\"\n  ) +\n  theme_minimal() +\n  scale_fill_viridis_d()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/frequency-ordering-3.png){width=672}\n:::\n:::\n\n\n\n\n`fct_infreq()` is particularly useful when: - You want to show categories in order of their occurrence - You're creating frequency plots or bar charts - You want to emphasize the most common categories - You need to create a visual hierarchy based on frequency\n\nYou can combine it with: - `fct_rev()` to reverse the order - `fct_lump()` to first combine rare categories - Other grouping or faceting approaches to show frequency distributions within subgroups\n\n## Simplifying Categories with fct_lump\n\nWhen dealing with data that has many categories, `fct_lump` is invaluable for creating more manageable visualizations. Here's how to use it effectively:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using the starwars dataset to demonstrate fct_lump with species\nstarwars %>%\n  # Remove NAs for cleaner visualization\n  filter(!is.na(species)) %>%\n  # Count species\n  count(species) %>%\n  # Keep only the top 5 species, lumping others together\n  mutate(\n    species_lumped = fct_lump_n(species, n = 7, w = n),\n    species_lumped = fct_reorder(species_lumped, n, .desc = F)\n  ) %>%\n  ggplot(aes(x = species_lumped, y = n)) +\n  geom_col(fill = \"steelblue\") +\n  labs(\n    x = \"Species\",\n    y = \"Count\",\n    title = \"Star Wars Characters by Species\",\n    subtitle = \"Showing top 7 species, with others combined\\nTied species are all kept\"\n  ) +\n  theme_minimal() +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](Ordered-Barcharts_files/figure-html/fct-lump-example-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Demonstrate different lumping approaches\nstarwars %>%\n  filter(!is.na(species)) %>%\n  mutate(\n    # Lump by proportion\n    prop_lumped = fct_lump_prop(species, prop = 0.1),\n    # Lump keeping min number of items\n    min_lumped = fct_lump_min(species, min = 3),\n    # Lump smaller categories until reaching cumulative proportion\n    cumsum_lumped = fct_lump_lowfreq(species)\n  ) %>%\n  select(species, prop_lumped, min_lumped, cumsum_lumped) %>%\n  count(species, prop_lumped, min_lumped, cumsum_lumped) %>%\n  knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|species        |prop_lumped |min_lumped |cumsum_lumped  |  n|\n|:--------------|:-----------|:----------|:--------------|--:|\n|Aleena         |Other       |Other      |Aleena         |  1|\n|Besalisk       |Other       |Other      |Besalisk       |  1|\n|Cerean         |Other       |Other      |Cerean         |  1|\n|Chagrian       |Other       |Other      |Chagrian       |  1|\n|Clawdite       |Other       |Other      |Clawdite       |  1|\n|Droid          |Other       |Droid      |Droid          |  6|\n|Dug            |Other       |Other      |Dug            |  1|\n|Ewok           |Other       |Other      |Ewok           |  1|\n|Geonosian      |Other       |Other      |Geonosian      |  1|\n|Gungan         |Other       |Gungan     |Gungan         |  3|\n|Human          |Human       |Human      |Human          | 35|\n|Hutt           |Other       |Other      |Hutt           |  1|\n|Iktotchi       |Other       |Other      |Iktotchi       |  1|\n|Kaleesh        |Other       |Other      |Kaleesh        |  1|\n|Kaminoan       |Other       |Other      |Kaminoan       |  2|\n|Kel Dor        |Other       |Other      |Kel Dor        |  1|\n|Mirialan       |Other       |Other      |Mirialan       |  2|\n|Mon Calamari   |Other       |Other      |Mon Calamari   |  1|\n|Muun           |Other       |Other      |Muun           |  1|\n|Nautolan       |Other       |Other      |Nautolan       |  1|\n|Neimodian      |Other       |Other      |Neimodian      |  1|\n|Pau'an         |Other       |Other      |Pau'an         |  1|\n|Quermian       |Other       |Other      |Quermian       |  1|\n|Rodian         |Other       |Other      |Rodian         |  1|\n|Skakoan        |Other       |Other      |Skakoan        |  1|\n|Sullustan      |Other       |Other      |Sullustan      |  1|\n|Tholothian     |Other       |Other      |Tholothian     |  1|\n|Togruta        |Other       |Other      |Togruta        |  1|\n|Toong          |Other       |Other      |Toong          |  1|\n|Toydarian      |Other       |Other      |Toydarian      |  1|\n|Trandoshan     |Other       |Other      |Trandoshan     |  1|\n|Twi'lek        |Other       |Other      |Twi'lek        |  2|\n|Vulptereen     |Other       |Other      |Vulptereen     |  1|\n|Wookiee        |Other       |Other      |Wookiee        |  2|\n|Xexto          |Other       |Other      |Xexto          |  1|\n|Yoda's species |Other       |Other      |Yoda's species |  1|\n|Zabrak         |Other       |Other      |Zabrak         |  2|\n\n\n:::\n:::\n\n\n\n\nKey `fct_lump` variants:\n\n1.  `fct_lump_n()`: Keep n most frequent categories\n2.  `fct_lump_prop()`: Keep categories that appear more than proportion p\n3.  `fct_lump_min()`: Keep categories that appear at least n times\n4.  `fct_lump_lowfreq()`: Progressively lump low-frequency categories\n\nThis technique is particularly useful when: - You have many categories with long tails of low-frequency items - You want to focus attention on the most important categories - You need to create more manageable legends or axis labels\n\n## Tips and Best Practices\n\n1.  Always consider whether ascending or descending order makes more sense for your visualization\n2.  Use `coord_flip()` for long category names\n3.  Consider using `fct_lump()` to combine small categories\n4.  Remember that `fct_reorder()` takes a summary function as its third argument (default is median)\n5.  Use `fct_infreq()` for ordering by frequency of occurrence\n\n## Common Pitfalls to Avoid\n\n1.  Forgetting to handle NA values appropriately\n2.  Not considering the direction of ordering\n3.  Applying `fct_reorder()` after creating the plot\n4.  Using overly complex ordering when simple would suffice\n5.  Not documenting the reasoning behind specific ordering choices\n\n## Conclusion\n\nEffective ordering of categorical variables is crucial for creating meaningful visualizations. The `forcats` package provides a robust set of tools for this purpose, and understanding when to use each function will help you create more effective data visualizations.\n",
    "supporting": [
      "Ordered-Barcharts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}