{
  "hash": "09aaa741bbe9739e6efe79f0f09f59d4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Common Gotchas with Text, Margins, and Spacing in ggplot2\"\nformat: html\nexecute:\n  warning: false\n  message: false\n---\n\n\n\n\n## Introduction\n\nText alignment, margins, and spacing are common sources of frustration in ggplot2. This guide covers frequent issues and their solutions.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\n# Create a base plot for examples\nbase_plot <- penguins %>%\n  ggplot(aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +\n  geom_point()\n```\n:::\n\n\n\n\n## Text Alignment Gotchas\n\n### 1. Long Axis Labels Getting Cut Off\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Long labels getting cut off\nproblematic_plot <- mpg %>%\n  mutate(manufacturer = str_to_title(manufacturer)) %>%\n  ggplot(aes(manufacturer, hwy)) +\n  geom_boxplot() +\n  labs(x = \"Manufacturer (with very long axis label that gets cut off)\")\n\n# Solution 1: Adjust margin\nsolution_1 <- problematic_plot +\n  theme(axis.title.x = element_text(margin = margin(t = 20)))\n\n# Solution 2: Text wrapping\nsolution_2 <- problematic_plot +\n  scale_x_discrete(label = function(x) str_wrap(x, width = 10)) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n# Compare\nproblematic_plot\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/axis-label-cutoff-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsolution_1\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/axis-label-cutoff-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsolution_2\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/axis-label-cutoff-3.png){width=672}\n:::\n:::\n\n\n\n\n### 2. Facet Label Alignment Issues\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Misaligned facet labels\nproblematic_facets <- penguins %>%\n  ggplot(aes(bill_length_mm, bill_depth_mm)) +\n  geom_point() +\n  facet_wrap(~island) +\n  theme(strip.text = element_text(hjust = 0))  # Wrong alignment\n\n# Solution: Proper centering and spacing\nfixed_facets <- problematic_facets +\n  theme(\n    strip.text = element_text(\n      hjust = 0.5,  # Center text\n      margin = margin(t = 5, b = 5)  # Add vertical space\n    ),\n    strip.background = element_rect(\n      fill = \"gray95\",\n      color = \"gray80\"\n    )\n  )\n\n# Compare\nproblematic_facets\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/facet-alignment-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_facets\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/facet-alignment-2.png){width=672}\n:::\n:::\n\n\n\n\n### 3. Legend Title Wrapping\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Long legend title\nproblematic_legend <- base_plot +\n  labs(color = \"Species of Penguins with Very Long Legend Title That Wraps Awkwardly\")\n\n# Solution: Control wrapping and spacing\nfixed_legend <- base_plot +\n  labs(color = str_wrap(\"Species of Penguins with Very Long Legend Title That Wraps Nicely\", width = 20)) +\n  theme(\n    legend.title = element_text(lineheight = 0.9),\n    legend.margin = margin(t = 5, b = 5)\n  )\n\n# Compare\nproblematic_legend\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/legend-wrapping-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_legend\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/legend-wrapping-2.png){width=672}\n:::\n:::\n\n\n\n\n## Margin Gotchas\n\n### 1. Plot Margins Too Tight\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Tight margins cutting off elements\ntight_margins <- base_plot +\n  labs(title = \"Title Gets Cut Off With Tight Margins\",\n       caption = \"Caption also gets cut off\") +\n  theme(plot.margin = unit(c(0, 0, 0, 0), \"pt\"))\n\n# Solution: Proper margin spacing\nfixed_margins <- base_plot +\n  labs(title = \"Title Has Room to Breathe\",\n       caption = \"Caption has proper spacing\") +\n  theme(\n    plot.margin = margin(t = 20, r = 20, b = 20, l = 20),\n    plot.title = element_text(margin = margin(b = 10)),\n    plot.caption = element_text(margin = margin(t = 10))\n  )\n\n# Compare\ntight_margins\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/plot-margins-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_margins\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/plot-margins-2.png){width=672}\n:::\n:::\n\n\n\n\n### 2. Overlapping Multi-line Titles\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Overlapping title and subtitle\noverlapping_titles <- base_plot +\n  labs(\n    title = \"Main Title\",\n    subtitle = \"Subtitle that overlaps with the title because of insufficient spacing\"\n  ) +\n  theme(\n    plot.title = element_text(margin = margin(b = 0)),\n    plot.subtitle = element_text(margin = margin(t = 0))\n  )\n\n# Solution: Proper title spacing\nfixed_titles <- base_plot +\n  labs(\n    title = \"Main Title\",\n    subtitle = \"Subtitle with proper spacing from the title\"\n  ) +\n  theme(\n    plot.title = element_text(margin = margin(b = 10)),\n    plot.subtitle = element_text(margin = margin(t = 5, b = 15))\n  )\n\n# Compare\noverlapping_titles\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/title-spacing-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_titles\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/title-spacing-2.png){width=672}\n:::\n:::\n\n\n\n\n### 3. Legend Spacing Issues\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Cramped legend\ncramped_legend <- base_plot +\n  theme(\n    legend.margin = margin(0, 0, 0, 0),\n    legend.spacing = unit(0, \"pt\"),\n    legend.key.size = unit(10, \"pt\")\n  )\n\n# Solution: Proper legend spacing\nfixed_legend_spacing <- base_plot +\n  theme(\n    legend.margin = margin(5, 5, 5, 5),\n    legend.spacing = unit(5, \"pt\"),\n    legend.key.size = unit(15, \"pt\"),\n    legend.text = element_text(margin = margin(l = 5))\n  )\n\n# Compare\ncramped_legend\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/legend-spacing-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_legend_spacing\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/legend-spacing-2.png){width=672}\n:::\n:::\n\n\n\n\n## Spacing Gotchas\n\n### 1. Axis Text Overlapping\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Overlapping axis text\noverlapping_axis <- mpg %>%\n  ggplot(aes(manufacturer, hwy)) +\n  geom_boxplot() +\n  theme(axis.text.x = element_text(angle = 45))  # Missing hjust\n\n# Solution: Proper text adjustment\nfixed_axis <- mpg %>%\n  ggplot(aes(manufacturer, hwy)) +\n  geom_boxplot() +\n  theme(\n    axis.text.x = element_text(\n      angle = 45,\n      hjust = 1,  # Right-align rotated text\n      vjust = 1,  # Vertical adjustment\n      margin = margin(t = 5)  # Space from axis\n    )\n  )\n\n# Compare\noverlapping_axis\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/axis-overlap-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_axis\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/axis-overlap-2.png){width=672}\n:::\n:::\n\n\n\n\n### 2. Facet Spacing Issues\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problem: Poor facet spacing\npoor_facet_spacing <- penguins %>%\n  ggplot(aes(bill_length_mm, bill_depth_mm)) +\n  geom_point() +\n  facet_wrap(~species + island) +\n  theme(panel.spacing = unit(0, \"pt\"))\n\n# Solution: Better facet spacing\nfixed_facet_spacing <- penguins %>%\n  ggplot(aes(bill_length_mm, bill_depth_mm)) +\n  geom_point() +\n  facet_wrap(~species + island) +\n  theme(\n    panel.spacing = unit(2, \"lines\"),\n    strip.text = element_text(margin = margin(t = 5, b = 5))\n  )\n\n# Compare\npoor_facet_spacing\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/facet-spacing-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfixed_facet_spacing\n```\n\n::: {.cell-output-display}\n![](Common-gotchas-with-text_files/figure-html/facet-spacing-2.png){width=672}\n:::\n:::\n\n\n\n\n## Common Solutions Cheat Sheet\n\n1. **Text Alignment**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_fixes <- list(\n  # Long axis labels\n  axis_text = theme(\n    axis.text.x = element_text(\n      angle = 45,\n      hjust = 1,\n      vjust = 1\n    )\n  ),\n  \n  # Centered facet labels\n  facet_text = theme(\n    strip.text = element_text(\n      hjust = 0.5,\n      margin = margin(t = 5, b = 5)\n    )\n  ),\n  \n  # Wrapped legend title\n  legend_text = theme(\n    legend.title = element_text(\n      lineheight = 0.9,\n      margin = margin(b = 5)\n    )\n  )\n)\n```\n:::\n\n\n\n\n2. **Margins**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmargin_fixes <- list(\n  # Safe plot margins\n  plot_margins = theme(\n    plot.margin = margin(t = 20, r = 20, b = 20, l = 20)\n  ),\n  \n  # Title spacing\n  title_margins = theme(\n    plot.title = element_text(margin = margin(b = 10)),\n    plot.subtitle = element_text(margin = margin(t = 5, b = 15)),\n    plot.caption = element_text(margin = margin(t = 10))\n  ),\n  \n  # Legend spacing\n  legend_margins = theme(\n    legend.margin = margin(5, 5, 5, 5),\n    legend.spacing = unit(5, \"pt\"),\n    legend.key.size = unit(15, \"pt\")\n  )\n)\n```\n:::\n\n\n\n\n3. **Spacing**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspacing_fixes <- list(\n  # Panel spacing\n  panel_spacing = theme(\n    panel.spacing = unit(2, \"lines\")\n  ),\n  \n  # Axis spacing\n  axis_spacing = theme(\n    axis.title.x = element_text(margin = margin(t = 10)),\n    axis.title.y = element_text(margin = margin(r = 10))\n  ),\n  \n  # Legend key spacing\n  legend_spacing = theme(\n    legend.key.spacing = unit(5, \"pt\"),\n    legend.text = element_text(margin = margin(l = 5))\n  )\n)\n```\n:::\n\n\n\n\n## Best Practices\n\n1. Always check plot margins first when elements are cut off\n2. Use `hjust` and `vjust` for fine-tuning text alignment\n3. Add appropriate spacing between plot elements\n4. Test plots at different sizes\n5. Consider different output formats\n6. Use relative units when possible\n7. Think about text wrapping for long labels\n8. Keep consistency across related plots",
    "supporting": [
      "Common-gotchas-with-text_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}